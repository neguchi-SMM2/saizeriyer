<!DOCTYPE html>
<html>
    <head>
        <title>Saizeriyer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/x-icon" href="favicon.ico">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <h1>サイゼメニュー組み合わせ生成機</h1>
        <p class="info">指定された条件を満たすメニューの組み合わせを生成します。</p>
        <fieldset>
            <legend>条件</legend>
            <div>
                <label for="min_price">値段:</label>
                <input type="number" id="price" name="price" value="1000" min="0" />
            </div>
            <div>
                <input type="checkbox" id="alcohol" name="alcohol" />
                <label for="alcohol">アルコールを含む</label>
            </div>
            <div>
                <input type="checkbox" id="duplicate" name="duplicate" />
                <label for="duplicate">重複を許可</label>
            </div>
            <div>
                <input type="checkbox" id="lunch" name="lunch" />
                <label for="lunch">ランチメニューを含む</label>
            </div>
            <br>
            <button id="generate">生成</button>
        </fieldset>

        <div id="result">ここに結果が表示されます。</div>
        <script>
        let menuData = [];

        // JSON読み込み
        fetch("data.json")
        .then(res => res.json())
        .then(data => {
            menuData = data;
        });

        document.getElementById('generate').addEventListener('click', function () {
        const price = parseInt(document.getElementById('price').value, 10);
        const alcohol = document.getElementById('alcohol').checked;
        const duplicate = document.getElementById('duplicate').checked;
        const lunch = document.getElementById('lunch').checked;

        // 条件でフィルタ
        let filtered = menuData.filter(item => {
            if (!alcohol && item.type === "alcohol") return false;
            if (!lunch && item.type === "lunch") return false;
            return true;
        });

        let candidates = [];

        function dfs(start, combo, total) {
            if (total > price) return;

            // ✅ 条件: 予算-100 < total <= 予算
            if (total > price - 100 && total <= price && combo.length > 0) {
            candidates.push({ items: [...combo], total });
            }

            for (let i = start; i < filtered.length; i++) {
            const item = filtered[i];

            // ランチは1品まで
            if (item.type === "lunch" && combo.some(c => c.type === "lunch")) continue;

            combo.push(item);
            dfs(duplicate ? i : i + 1, combo, total + item.price);
            combo.pop();
            }
        }

        dfs(0, [], 0);

        // ランダムに1件選ぶ
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = "";

        if (candidates.length === 0) {
            resultDiv.textContent = "条件に合う組み合わせはありません。";
        } else {
            const choice = candidates[Math.floor(Math.random() * candidates.length)];
            const p = document.createElement("p");
            p.textContent = choice.items.map(i => i.name).join(" + ") + " = " + choice.total + "円";
            resultDiv.appendChild(p);
        }
        });
        </script>
    </body>
</html>
