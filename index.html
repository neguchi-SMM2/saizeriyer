<!DOCTYPE html>
<html>
    <head>
        <title>Saizeriyer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/x-icon" href="favicon.ico">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <h1>サイゼメニュー組み合わせ生成機</h1>
        <p class="info">指定された条件を満たすメニューの組み合わせを生成します。</p>
        <fieldset>
            <legend>条件</legend>
            <div>
                <label for="min_price">値段:</label>
                <input type="number" id="price" name="price" value="1000" min="0" />
            </div>
            <div>
                <input type="checkbox" id="alcohol" name="alcohol" />
                <label for="alcohol">アルコールを含む</label>
            </div>
            <div>
                <input type="checkbox" id="duplicate" name="duplicate" />
                <label for="duplicate">重複を許可</label>
            </div>
            <div>
                <input type="checkbox" id="lunch" name="lunch" />
                <label for="lunch">ランチメニューを含む</label>
            </div>
            <br>
            <button id="generate">生成</button>
        </fieldset>

        <div id="result">ここに結果が表示されます。</div>
        <script>
        let menuData = [];

        // JSON読み込み
        fetch("data.json")
        .then(res => res.json())
        .then(data => {
            menuData = data;
        });

        // 組み合わせ生成
        document.getElementById('generate').addEventListener('click', function () {
        const price = parseInt(document.getElementById('price').value, 10);
        const alcohol = document.getElementById('alcohol').checked;
        const duplicate = document.getElementById('duplicate').checked;
        const lunch = document.getElementById('lunch').checked;

        // 条件フィルタ
        let filtered = menuData.filter(item => {
            if (!alcohol && item.type === "alcohol") return false;
            if (!lunch && item.type === "lunch") return false;
            if (item.type === "lunch" && lunch) return true;
            return item.type === "normal" || item.type === "alcohol" || item.type === "lunch";
        });

        let results = [];

        function dfs(start, combo, total) {
            if (total > price) return;
            if (total <= price && combo.length > 0) {
            results.push({ items: [...combo], total });
            }

            for (let i = start; i < filtered.length; i++) {
            const item = filtered[i];
            combo.push(item);
            dfs(duplicate ? i : i + 1, combo, total + item.price);
            combo.pop();
            }
        }

        dfs(0, [], 0);

        // 重複結果削除
        let seen = new Set();
        results = results.filter(r => {
            const key = r.items.map(i => i.id).sort().join("-");
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
        });

        // 表示
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = "";
        if (results.length === 0) {
            resultDiv.textContent = "条件に合う組み合わせはありません。";
        } else {
            results.forEach(r => {
            const p = document.createElement("p");
            p.textContent = r.items.map(i => i.name).join(" + ") + " = " + r.total + "円";
            resultDiv.appendChild(p);
            });
        }
        });
        </script>
    </body>
</html>
