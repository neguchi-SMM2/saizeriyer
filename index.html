<!DOCTYPE html>
<html>
    <head>
        <title>Saizeriyer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/x-icon" href="favicon.ico">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <h1>ã‚µã‚¤ã‚¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼çµ„ã¿åˆã‚ã›ç”Ÿæˆæ©Ÿ</h1>
        <p class="info">æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã‚’æº€ãŸã™ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®çµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>
        <fieldset>
            <legend>æ¡ä»¶</legend>
            <div>
                <label for="min_price">å€¤æ®µ:</label>
                <input type="number" id="price" name="price" value="1000" min="0" />
            </div>
            <div>
                <input type="checkbox" id="alcohol" name="alcohol" />
                <label for="alcohol">ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ã‚’å«ã‚€</label>
            </div>
            <div>
                <input type="checkbox" id="duplicate" name="duplicate" />
                <label for="duplicate">é‡è¤‡ã‚’è¨±å¯</label>
            </div>
            <div>
                <input type="checkbox" id="lunch" name="lunch" />
                <label for="lunch">ãƒ©ãƒ³ãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å«ã‚€</label>
            </div>
            <br>
            <button id="generate">ç”Ÿæˆ</button>
        </fieldset>

        <div id="result">ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
        <script>
        let menuData = [];

        // JSONèª­ã¿è¾¼ã¿
        fetch("data.json")
        .then(res => res.json())
        .then(data => {
            menuData = data;
        });

        document.getElementById('generate').addEventListener('click', function () {
        const price = parseInt(document.getElementById('price').value, 10);
        const alcohol = document.getElementById('alcohol').checked;
        const duplicate = document.getElementById('duplicate').checked;
        const lunch = document.getElementById('lunch').checked;

        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = "<p>ç”Ÿæˆä¸­...</p>";

        setTimeout(() => {
            let filtered = menuData.filter(item => {
            if (!alcohol && item.type === "alcohol") return false;
            if (!lunch && item.type === "lunch") return false;
            return true;
            });

            const MAX_ITEMS = 10;
            const MAX_TRY = 10000;

            function getRandomCombo() {
            let combo = [];
            let total = 0;
            let count = Math.floor(Math.random() * MAX_ITEMS) + 1;

            for (let j = 0; j < count; j++) {
                const item = filtered[Math.floor(Math.random() * filtered.length)];
                if (item.type === "lunch" && combo.some(c => c.type === "lunch")) continue;
                if (!duplicate && combo.includes(item)) continue;
                if (total + item.price > price) continue;

                combo.push(item);
                total += item.price;
            }
            return { combo, total };
            }

            let found = null;
            let best = null;

            for (let t = 0; t < MAX_TRY; t++) {
            const { combo, total } = getRandomCombo();
            if (combo.length === 0) continue;

            if (total > price - 100 && total <= price) {
                found = { combo, total };
                break;
            }

            if (!best || Math.abs(price - total) < Math.abs(price - best.total)) {
                best = { combo, total };
            }
            }

            resultDiv.innerHTML = "";
            let target = found || best;

            if (!target) {
            resultDiv.textContent = "çµ„ã¿åˆã‚ã›ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
            return;
            }

            if (!found) {
            const warn = document.createElement("p");
            warn.textContent = "æ¡ä»¶ã«åˆã†çµ„ã¿åˆã‚ã›ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€è¿‘ã„é‡‘é¡ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚";
            resultDiv.appendChild(warn);
            }

            // ğŸ”¹ é›†è¨ˆï¼ˆåŒã˜å•†å“ã¾ã¨ã‚ï¼‰
            let summary = {};
            target.combo.forEach(i => {
            if (!summary[i.id]) {
                summary[i.id] = { ...i, count: 0 };
            }
            summary[i.id].count++;
            });

            // ğŸ”¹ å•†å“åã®æœ€å¤§å¹…ã‚’ç®—å‡º
            const nameWidth = Math.max(...Object.values(summary).map(i => i.name.length));

            // ğŸ”¹ è¡¨ç¤ºæ•´å½¢
            const lines = [];
            for (let id in summary) {
            const item = summary[id];
            const subtotal = item.price * item.count;
            lines.push(
                `${item.id.toString().padEnd(6)} - ${item.name.padEnd(nameWidth)}  ${item.count
                .toString()
                .padStart(2)}  ${subtotal.toString().padStart(5)}å††`
            );
            }

            lines.push(`åˆè¨ˆ : ${target.total}å††`);

            const pre = document.createElement("pre");
            pre.style.fontFamily = "monospace";
            pre.textContent = lines.join("\n");
            resultDiv.appendChild(pre);
        }, 50);
        });
        </script>
    </body>
</html>
