<!DOCTYPE html>
<html>
    <head>
        <title>Saizeriyer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/x-icon" href="favicon.ico">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <h1>サイゼメニュー組み合わせ生成機</h1>
        <p class="info">指定された条件を満たすメニューの組み合わせを生成します。</p>
        <fieldset>
            <legend>条件</legend>
            <div>
                <label for="min_price">値段:</label>
                <input type="number" id="price" name="price" value="1000" min="0" />
            </div>
            <div>
                <input type="checkbox" id="alcohol" name="alcohol" />
                <label for="alcohol">アルコールを含む</label>
            </div>
            <div>
                <input type="checkbox" id="duplicate" name="duplicate" />
                <label for="duplicate">重複を許可</label>
            </div>
            <div>
                <input type="checkbox" id="lunch" name="lunch" />
                <label for="lunch">ランチメニューを含む</label>
            </div>
            <br>
            <button id="generate">生成</button>
        </fieldset>

        <div id="result">ここに結果が表示されます。</div>
        <script>
        let menuData = [];

        // JSON読み込み
        fetch("data.json")
        .then(res => res.json())
        .then(data => {
            menuData = data;
        });

        document.getElementById('generate').addEventListener('click', function () {
        const price = parseInt(document.getElementById('price').value, 10);
        const alcohol = document.getElementById('alcohol').checked;
        const duplicate = document.getElementById('duplicate').checked;
        const lunch = document.getElementById('lunch').checked;

        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = "<p>生成中...</p>";

        setTimeout(() => {
            // 条件でフィルタ
            let filtered = menuData.filter(item => {
            if (!alcohol && item.type === "alcohol") return false;
            if (!lunch && item.type === "lunch") return false;
            return true;
            });

            const MAX_ITEMS = 15;   // 最大15品
            const MAX_TRY = 10000;  // ランダム試行回数

            function getRandomCombo() {
            let combo = [];
            let total = 0;

            // 1〜MAX_ITEMS品までランダムに選ぶ
            let count = Math.floor(Math.random() * MAX_ITEMS) + 1;

            for (let j = 0; j < count; j++) {
                const item = filtered[Math.floor(Math.random() * filtered.length)];
                // ランチは1品まで
                if (item.type === "lunch" && combo.some(c => c.type === "lunch")) continue;
                if (!duplicate && combo.includes(item)) continue;

                if (total + item.price > price) continue;

                combo.push(item);
                total += item.price;
            }
            return { combo, total };
            }

            let found = null;
            let best = null;

            for (let t = 0; t < MAX_TRY; t++) {
            const { combo, total } = getRandomCombo();

            if (combo.length === 0) continue;

            // ✅ 条件: 予算-100 < total <= 予算
            if (total > price - 100 && total <= price) {
                found = { combo, total };
                break; // 見つけたら即終了
            }

            // 代替候補（最も予算に近いもの）
            if (!best || Math.abs(price - total) < Math.abs(price - best.total)) {
                best = { combo, total };
            }
            }

            resultDiv.innerHTML = "";

            if (found) {
            found.combo.forEach(i => {
                const p = document.createElement("p");
                p.textContent = `${i.id} - ${i.name}`;
                resultDiv.appendChild(p);
            });
            const totalP = document.createElement("p");
            totalP.textContent = `合計：${found.total}円`;
            resultDiv.appendChild(totalP);
            } else if (best) {
            const warn = document.createElement("p");
            warn.textContent = "条件に合う組み合わせは見つかりませんでしたが、近い金額を表示します。";
            resultDiv.appendChild(warn);

            best.combo.forEach(i => {
                const p = document.createElement("p");
                p.textContent = `${i.id} - ${i.name}`;
                resultDiv.appendChild(p);
            });
            const totalP = document.createElement("p");
            totalP.textContent = `合計：${best.total}円`;
            resultDiv.appendChild(totalP);
            } else {
            resultDiv.textContent = "組み合わせが見つかりませんでした。";
            }
        }, 50);
        });
        </script>
    </body>
</html>
